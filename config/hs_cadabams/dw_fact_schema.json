{
	"database": "healthscore_dw",

	"insert_table_info": [
		{
			"tablename": "fact_patient_visits",
			"source_table": "hs_patient_visit_details",
			"fields": "patient_key,visit_hospital_key,visit_date_key,visit_time_key ,visit_doctor_staff_key ,hospital_patient_visit_id,checkin_ts,checkout_ts,checkout_type,delivery_ts,outcome_type,condition_at_discharge,discharge_ts,visit_type,visit_reason ,visit_rate_category_nm,visit_ip_nbr ,admission_method ,cancel_reason,ward_nm,referral_source,created_by_staff_key,patient_visit_cd,primary_ext_doctor_staff_key, reference_ext_doctor_staff_key,pharmacy_checkin_flg,source_cd,etl_load_id",
			"insert_query": "SELECT  p.patient_key, p.hospital_key, DATE(pvd.checkin_ts) AS visit_date_key, TIME(pvd.checkin_ts) AS visit_time_key, ds.staff_key as visit_doctor_staff_key, pvd.patient_visit_id, pvd.checkin_ts, pvd.checkout_ts, pvd.checkout_type, pvd.delivery_ts, pvd.outcome_type, pvd.condition_at_discharge, pvd.discharge_ts, pvd.visit_type, pvd.visit_reason, rcm.rate_category_nm, pvd.ip_nbr, pvd.admission_method, pvd.cancel_reason, w.hospital_ward_nm,pvd.referral_source, ds_cb.staff_key,pvd.patient_visit_cd,ds_prdoc.external_hospital_staff_key as primary_ext_doctor_staff_key,ds_refdoc.external_hospital_staff_key as reference_ext_doctor_staff_key,pvd.pharmacy_checkin_flg,'{0}',{1} FROM healthscore_stg.hs_patient_visit_details pvd JOIN healthscore_stg.hs_patient_master hpm ON hpm.patient_id = pvd.patient_id AND hpm.primary_hospital_id = pvd.hospital_id JOIN healthscore_stg.hs_hospital_master hm ON hpm.primary_hospital_id = hm.hospital_id JOIN healthscore_dw.map_patient_hospital p ON hpm.patient_cd = p.hospital_patient_cd and p.hospital_cd=hm.hs_hospital_cd_guid  JOIN healthscore_stg.hs_rate_category_master rcm ON pvd.visit_rate_category_id = rcm.rate_category_master_id JOIN healthscore_dw.dim_staff ds_cb ON ds_cb.hospital_staff_user_nm = pvd.created_by and ds_cb.hospital_key=p.hospital_key left JOIN healthscore_dw.dim_staff ds ON ds.hospital_staff_id = pvd.doctor_id and ds.hospital_key=p.hospital_key LEFT JOIN healthscore_dw.dim_hospital_wards AS w ON pvd.ward_id = w.hospital_ward_id AND p.hospital_key = w.hospital_key left JOIN healthscore_dw.dim_external_hospital_staff ds_prdoc ON ds_prdoc.ext_doctor_id = pvd.primary_doctor_id and ds_prdoc.hospital_key=p.hospital_key left JOIN healthscore_dw.dim_external_hospital_staff ds_refdoc ON ds_refdoc.ext_doctor_id = pvd.reference_doctor_id and ds_refdoc.hospital_key=p.hospital_key",
			"where_clause": "p.hospital_key=%i",
			"update_fields": " visit_doctor_staff_key = src.visit_doctor_staff_key, checkin_ts=src.checkin_ts, checkout_ts=src.checkout_ts, checkout_type=src.checkout_type, delivery_ts=src.delivery_ts, outcome_type=src.outcome_type, condition_at_discharge=src.condition_at_discharge, discharge_ts=src.discharge_ts, visit_type=src.visit_type, visit_reason=src.visit_reason, visit_rate_category_nm=src.rate_category_nm, visit_ip_nbr=src.ip_nbr, admission_method=src.admission_method, cancel_reason=src.cancel_reason, ward_nm=src.hospital_ward_nm, referral_source=src.referral_source, created_by_staff_key=src.staff_key,patient_visit_cd=src.patient_visit_cd, pharmacy_checkin_flg=src.pharmacy_checkin_flg, primary_ext_doctor_staff_key= src.primary_ext_doctor_staff_key, reference_ext_doctor_staff_key=src.reference_ext_doctor_staff_key"
		},
		{
			"tablename": "fact_patient_visit_admission",
			"source_table": "vw_patient_visit_spl_admission_details",
			"fields": "patient_visit_key,patient_key,visit_hospital_key,visit_diagnosis,prev_hospital_duration_of_stay,spl_req,admission_note,source_cd,etl_load_id",
			"insert_query": "select fpv.patient_visit_key,fpv.patient_key,fpv.visit_hospital_key, diagnosis,prev_hospital_duration_of_stay,spl_req,admission_note,'{0}',{1} from healthscore_stg.vw_patient_visit_spl_admission_details vad join healthscore_dw.fact_patient_visits fpv on fpv.hospital_patient_visit_id = vad.patient_visit_id and fpv.source_cd = '{0}'",
			"where_clause": "fpv.visit_hospital_key=%i",
			"update_fields": "visit_diagnosis=src.diagnosis,prev_hospital_duration_of_stay=src.prev_hospital_duration_of_stay,spl_req =src.spl_req,admission_note=src.admission_note"
		},
		{
			"tablename": "map_patient_visit_doctors",
			"source_table": "hs_patient_visit_doctors",
			"fields": "patient_key,visit_hospital_key,patient_visit_key,visit_doctor_staff_key,hospital_visit_doctor_id,hospital_patient_visit_id,patient_visit_doctor_ts,source_cd,etl_load_id",
			"insert_query": "SELECT pv.patient_key, pv.visit_hospital_key, pv.patient_visit_key, ds.staff_key AS visit_doctor_staff_key, pvd.visit_doctor_id AS hospital_visit_doctor_id, pvd.patient_visit_id AS hospital_patient_visit_id, pvd.created_ts AS patient_visit_doctor_ts, '{0}',{1} FROM healthscore_stg.hs_patient_visit_doctors pvd   JOIN healthscore_dw.fact_patient_visits pv on pv.hospital_patient_visit_id=pvd.patient_visit_id and source_cd='{0}' JOIN healthscore_dw.map_patient_hospital mph on mph.hospital_key=pv.visit_hospital_key and mph.patient_key=pv.patient_key  JOIN healthscore_dw.dim_staff ds ON ds.hospital_key = pv.visit_hospital_key AND ds.hospital_staff_id = pvd.hospital_staff_id",
			"where_clause": "mph.hospital_key=%i",
			"update_fields": "patient_visit_doctor_ts=src.patient_visit_doctor_ts"
		},
		{
			"tablename": "fact_patient_vitals",
			"source_table": "hs_patient_visit_vitals",
			"fields": "patient_key,vital_ref_component_id,vital_ref_display_txt,measurementunit_ref_component_id,measurementunit_ref_display_txt,patient_vital_value,vital_recorded_date_key,vital_recorded_time_key,vital_recorded_ts,biomedicaldevice_ref_id,recorded_hospital_key,recorded_patient_visit_key,vital_created_ts,created_by_staff_key,source_cd,etl_load_id",
			"insert_query": "select pv.patient_key, vm.vital_ref_component_id,vm.vital_ref_display_txt,vm.measurementunit_ref_component_id,vm.measurementunit_ref_display_txt,vv.patient_vital_value,date(vv.vital_recorded_ts) as vital_recorded_date_key,time(vv.vital_recorded_ts) as vital_recorded_time_key,vv.vital_recorded_ts,vv.biomedicaldevice_ref_id, pv.visit_hospital_key, pv.patient_visit_key, vv.created_ts,ds.staff_key,'{0}',{1} from healthscore_stg.hs_patient_visit_vitals vv join healthscore_stg.hs_ref_vitals_master vm on vv.vital_ref_id = vm.vital_ref_component_id join healthscore_stg.hs_patient_master hpm on hpm.patient_id=vv.patient_id join healthscore_stg.hs_hospital_master hm on hpm.primary_hospital_id=hm.hospital_id join healthscore_dw.map_patient_hospital p on hpm.patient_cd= p.hospital_patient_cd and hm.hs_hospital_cd_guid=p.hospital_cd join healthscore_dw.fact_patient_visits pv on pv.patient_key=p.patient_key and pv.visit_hospital_key=p.hospital_key and pv.hospital_patient_visit_id=vv.created_patient_visit_id join healthscore_dw.dim_staff ds on ds.hospital_staff_user_nm=vv.created_by and ds.hospital_key=p.hospital_key",
			"where_clause": "pv.visit_hospital_key=%i",
			"update_fields": "vital_ref_display_txt=src.vital_ref_display_txt,measurementunit_ref_component_id=src.measurementunit_ref_component_id, measurementunit_ref_display_txt=src.measurementunit_ref_display_txt,patient_vital_value=src.patient_vital_value,biomedicaldevice_ref_id=src.biomedicaldevice_ref_id,recorded_hospital_key=src.visit_hospital_key, recorded_patient_visit_key=src.patient_visit_key,vital_recorded_date_key=src.vital_recorded_date_key ,vital_recorded_time_key=src.vital_recorded_time_key,vital_recorded_ts=src.vital_recorded_ts"
		},
		{
			"tablename": "fact_patient_visitbills",
			"source_table": "hs_patient_visit_bill",
			"fields": "patient_key,visit_hospital_key,patient_visit_key,visit_bill_id,visit_bill_cd, visit_bill_total_amt,visit_bill_paid_amt,visit_bill_concession_amt,visit_bill_waived_amt,visit_bill_refund_amt,visit_bill_balance_amt,visit_bill_from_ts,visit_bill_to_ts,visit_bill_comments,visit_bill_adjusted_flg,visit_bill_created_ts,visit_bill_date_key,visit_bill_time_key,visit_billed_ts,created_by_staff_key,modified_by_staff_key,source_cd,etl_load_id",
			"insert_query": "SELECT fpv.patient_key, fpv.visit_hospital_key, fpv.patient_visit_key,pvb.visit_bill_id, pvb.visit_bill_cd, pvb.bill_total_amt AS visit_bill_total_amt, pvb.bill_paid_amt AS visit_bill_paid_amt, pvb.bill_concession_amt AS visit_bill_concession_amt, pvb.waived_amt AS visit_bill_waived_amt, pvb.bill_refund_amt AS visit_bill_refund_amt,pvb.bill_balance_amt AS visit_bill_balance_amt, pvb.bill_from_ts, pvb.bill_to_ts, pvb.bill_comments AS visit_bill_comments, pvb.adjusted_flg AS visit_bill_adjusted_flg, pvb.created_ts as visit_bill_created_ts,DATE(pvb.created_ts) as visit_bill_date_key,TIME(pvb.created_ts) as visit_bill_time_key, pvb.billed_ts as visit_billed_ts, ds_c.staff_key AS created_by_staff_key, ds_m.staff_key AS modified_by_staff_key,'{0}',{1} FROM healthscore_stg.hs_patient_visit_bill pvb JOIN healthscore_dw.fact_patient_visits fpv ON fpv.hospital_patient_visit_id = pvb.patient_visit_id and source_cd='{0}' join healthscore_dw.map_patient_hospital mp on mp.hospital_key = fpv.visit_hospital_key and mp.patient_key=fpv.patient_key left JOIN healthscore_dw.dim_staff ds_c ON ds_c.hospital_key = fpv.visit_hospital_key AND ds_c.hospital_staff_user_nm = pvb.created_by LEFT JOIN healthscore_dw.dim_staff ds_m ON ds_m.hospital_key = fpv.visit_hospital_key AND ds_m.hospital_staff_user_nm = pvb.modified_by",
			"where_clause": "fpv.visit_hospital_key=%i",
			"update_fields": "patient_key=src.patient_key,visit_hospital_key=src.visit_hospital_key,patient_visit_key=src.patient_visit_key,visit_bill_cd=src.visit_bill_cd,visit_bill_total_amt=src.visit_bill_total_amt,visit_bill_paid_amt=src.visit_bill_paid_amt,visit_bill_concession_amt=src.visit_bill_concession_amt,visit_bill_waived_amt=src.visit_bill_waived_amt,visit_bill_refund_amt=src.visit_bill_refund_amt,visit_bill_balance_amt=src.visit_bill_balance_amt,visit_bill_from_ts=src.bill_from_ts,visit_bill_to_ts=src.bill_to_ts,visit_bill_comments=src.visit_bill_comments,visit_bill_adjusted_flg=src.visit_bill_adjusted_flg,visit_bill_created_ts=src.visit_bill_created_ts,visit_bill_date_key=src.visit_bill_date_key,visit_bill_time_key=src.visit_bill_time_key,visit_billed_ts=src.visit_billed_ts,created_by_staff_key=src.created_by_staff_key,modified_by_staff_key=src.modified_by_staff_key"
		},
		{
			"tablename": "fact_patient_medications",
			"source_table": "hs_patient_medication_details",
			"fields": "patient_key,medication_details_id, pharma_product_ref_id, pharma_product_ref_display_txt , pharma_brand_nm, dosage, drug_form_ref_id , drug_form_ref_display_txt, frequency, comments, start_dt, end_dt, active_flg,prescribed_doctor_staff_key, prescribed_hospital_key, prescribed_ts, prescribed_patient_visit_key,created_by_staff_key,prescribed_date_key,prescribed_time_key,etl_load_id,source_cd",
			"insert_query": "SELECT  pvd.patient_key, pmd.medication_details_id,pmd.pharma_product_ref_id, pmd.pharma_product_ref_display_txt, pmd.pharma_brand_name, pmd.dosage, pmd.drug_form_ref_id, pmd.drug_form_ref_display_txt, pmd.frequency, pmd.comments, pmd.start_dt, pmd.end_dt, pmd.active_flg,  pvd.visit_doctor_staff_key, pvd.visit_hospital_key, pmd.created_ts, pvd.patient_visit_key, ds.staff_key, DATE(pmd.created_ts) as prescribed_date_key, TIME(pmd.created_ts) as prescribed_time_key,{1},'{0}' FROM healthscore_stg.hs_patient_medication_details pmd JOIN healthscore_stg.hs_patient_master pm ON pm.patient_id = pmd.patient_id join healthscore_stg.hs_hospital_master hm on hm.hospital_id=pm.primary_hospital_id join healthscore_dw.map_patient_hospital mph on mph.hospital_cd=hm.hs_hospital_cd_guid and mph.hospital_patient_cd=pm.patient_cd JOIN healthscore_dw.map_patient_visit_doctors pvd ON pvd.hospital_visit_doctor_id = pmd.created_patient_visit_doctor_id and pvd.visit_hospital_key=mph.hospital_key and pvd.patient_key=mph.patient_key and source_cd='{0}' JOIN healthscore_dw.dim_staff ds ON ds.hospital_staff_user_nm = pmd.created_by AND ds.hospital_key = pvd.visit_hospital_key",
			"where_clause": "pvd.visit_hospital_key=%i",
			"update_fields": "pharma_product_ref_id=src.pharma_product_ref_id, pharma_product_ref_display_txt=src.pharma_product_ref_display_txt,pharma_brand_nm=src.pharma_brand_name, dosage=src.dosage, drug_form_ref_id =src.drug_form_ref_id, drug_form_ref_display_txt=src.drug_form_ref_display_txt, frequency=src.frequency,  comments=src.comments, start_dt=src.start_dt, end_dt=src.end_dt, active_flg=src.active_flg, prescribed_doctor_staff_key=src.visit_doctor_staff_key, prescribed_hospital_key=src.visit_hospital_key, prescribed_ts=src.created_ts, prescribed_patient_visit_key=src.patient_visit_key,created_by_staff_key=src.staff_key,prescribed_date_key=src.prescribed_date_key,prescribed_time_key=src.prescribed_time_key"
		},
		{
			"tablename": "fact_patient_clinical_info",
			"source_table": "hs_patient_allergy_details",
			"fields": "patient_key,patient_visit_key,created_staff_key,clinical_info_type_cd,clinical_info_ref_id,clinical_info_desc,effective_from_ts,effective_to_ts,recorded_date_key,recorded_time_key,active_flg,source_cd,etl_load_id",
			"insert_query": "select map_p.patient_key, fpv.patient_visit_key,dim_s.staff_key, 'allergy',allergy_ref_id as clinical_info_ref_id,allergy_ref_display_txt as clinical_info_desc,pad.created_ts as effective_from_ts,case when pad.active_flg =0 then pad.modified_ts else null end as effective_to_ts, date(pad.created_ts) as recorded_date_key,time(pad.created_ts) as recorded_time_key,pad.active_flg,'{0}',{1} from healthscore_stg.hs_patient_allergy_details pad join healthscore_stg.hs_patient_master pm on pm.patient_id = pad.patient_id join healthscore_stg.hs_hospital_master hm on hm.hospital_id =  pm.primary_hospital_id join healthscore_dw.map_patient_hospital map_p on map_p.hospital_patient_id = pad.patient_id and map_p.hospital_cd = hm.hs_hospital_cd_guid LEFT JOIN healthscore_dw.fact_patient_visits fpv on pad.created_patient_visit_id = fpv.hospital_patient_visit_id and map_p.hospital_key = fpv.visit_hospital_key LEFT JOIN healthscore_dw.dim_staff dim_s ON dim_s.hospital_key = map_p.hospital_key AND dim_s.hospital_staff_user_nm = pad.created_by",
			"where_clause": "fpv.visit_hospital_key=%i",
			"update_fields": "patient_visit_key=src.patient_visit_key,created_staff_key=src.staff_key,clinical_info_desc=src.clinical_info_desc,effective_to_ts=src.effective_to_ts,recorded_date_key=src.recorded_date_key,recorded_time_key=src.recorded_time_key,active_flg=src.active_flg"
		},
		{
			"tablename": "fact_patient_clinical_info",
			"source_table": "hs_patient_family_history_details",
			"fields": "patient_key,patient_visit_key,created_staff_key,clinical_info_type_cd,clinical_info_ref_id,clinical_info_desc,effective_from_ts,effective_to_ts,recorded_date_key,recorded_time_key,active_flg,source_cd,etl_load_id",
			"insert_query": "SELECT  mph.patient_key, CASE WHEN fhd.created_patient_visit_id IS NULL THEN NULL ELSE fpv.patient_visit_key END as patient_visit_key, ds.staff_key, 'familyhistory', fhd.family_history_ref_id as clinical_info_ref_id, CONCAT(family_relative_ref_id,'-',fhd.family_history_ref_display_txt) as clinical_info_desc, fhd.history_since_dt as effective_from_ts, CASE WHEN fhd.active_flg = 0 THEN fhd.modified_ts ELSE NULL END AS effective_to_ts,date(fhd.created_ts) as recorded_date_key, time(fhd.created_ts)as recorded_time_key,fhd.active_flg,'{0}',{1} FROM healthscore_stg.hs_patient_family_history_details fhd JOIN healthscore_stg.hs_patient_master hpm ON hpm.patient_id = fhd.patient_id JOIN healthscore_stg.hs_hospital_master hhm ON hhm.hospital_id = hpm.primary_hospital_id JOIN healthscore_dw.map_patient_hospital mph ON mph.hospital_patient_cd = hpm.patient_cd AND mph.hospital_cd = hhm.hs_hospital_cd_guid LEFT JOIN healthscore_dw.dim_staff ds ON ds.hospital_staff_user_nm = fhd.created_by AND ds.hospital_key = mph.hospital_key LEFT JOIN healthscore_dw.fact_patient_visits fpv ON fpv.patient_key = mph.patient_key AND fpv.visit_hospital_key = mph.hospital_key AND fpv.hospital_patient_visit_id = fhd.created_patient_visit_id",
			"where_clause": "fpv.visit_hospital_key=%i",
			"update_fields": "patient_visit_key=src.patient_visit_key,created_staff_key=src.staff_key,clinical_info_desc=src.clinical_info_desc,effective_to_ts=src.effective_to_ts,recorded_date_key=src.recorded_date_key,recorded_time_key=src.recorded_time_key,active_flg=src.active_flg"
		},
		{
			"tablename": "fact_patient_clinical_info",
			"source_table": "hs_patient_past_history_details",
			"fields": "patient_key,patient_visit_key,created_staff_key,clinical_info_type_cd,clinical_info_ref_id,clinical_info_desc,effective_from_ts,effective_to_ts,recorded_date_key,recorded_time_key,active_flg,source_cd,etl_load_id",
			"insert_query": "SELECT  mph.patient_key, case when pphd.created_patient_visit_id is null then null else fpv.patient_visit_key end as patient_visit_key, ds.staff_key, 'pasthistory', pphd.past_history_ref_id as clinical_info_ref_id, concat(pphd.past_history_ref_display_txt,'-',pphd.hospital_nm,'-',pphd.doctor_cd,'-',pphd.location_nm,'-',pphd.comments) as clinical_info_desc, coalesce(pphd.history_since_dt,pphd.created_ts) as effective_from_ts, CASE WHEN pphd.active_flg = 0 THEN pphd.modified_ts ELSE NULL END AS effective_to_ts,date(pphd.created_ts) as recorded_date_key, time(pphd.created_ts) as recorded_time_key, pphd.active_flg,'{0}',{1} FROM healthscore_stg.hs_patient_past_history_details pphd JOIN  healthscore_stg.hs_patient_master hpm on hpm.patient_id=pphd.patient_id JOIN  healthscore_stg.hs_hospital_master hhm on hhm.hospital_id=hpm.primary_hospital_id JOIN  healthscore_dw.map_patient_hospital mph on mph.hospital_patient_cd=hpm.patient_cd and mph.hospital_cd=hhm.hs_hospital_cd_guid left JOIN healthscore_dw.dim_staff ds on ds.hospital_staff_user_nm=pphd.created_by and ds.hospital_key=mph.hospital_key left JOIN  healthscore_dw.fact_patient_visits fpv on fpv.patient_key=mph.patient_key and fpv.visit_hospital_key=mph.hospital_key and fpv.hospital_patient_visit_id=pphd.created_patient_visit_id",
			"where_clause": "fpv.visit_hospital_key=%i",
			"update_fields": "patient_visit_key=src.patient_visit_key,created_staff_key=src.staff_key,clinical_info_desc=src.clinical_info_desc,effective_to_ts=src.effective_to_ts,recorded_date_key=src.recorded_date_key,recorded_time_key=src.recorded_time_key,active_flg=src.active_flg"
		},
		{
			"tablename": "fact_patient_clinical_info",
			"source_table": "vw_patient_visit_diagnosis_tags",
			"fields": "patient_key,patient_visit_key,created_staff_key,clinical_info_type_cd,clinical_info_ref_id,clinical_info_desc,effective_from_ts,effective_to_ts,recorded_date_key,recorded_time_key,active_flg,source_cd,etl_load_id",
			"insert_query": "SELECT mph.patient_key, case when pvd.patient_visit_id is null then null else fpv.patient_visit_key end as patient_visit_key,null as staff_key, 'diagnosis', patient_diagnosis_tag_id as clinical_info_ref_id, concat(pvd.diagnosis_desc) as clinical_info_desc,pvd.created_ts as effective_from_ts, CASE WHEN pvd.active_flg = 0 THEN pvd.modified_ts ELSE NULL END AS effective_to_ts, date(pvd.created_ts) as recorded_date_key, time(pvd.created_ts) as recorded_time_key, pvd.active_flg  ,'{0}',{1} FROM healthscore_stg.vw_patient_visit_diagnosis_tags pvd JOIN  healthscore_stg.hs_patient_master hpm on hpm.patient_id=pvd.patient_id JOIN  healthscore_stg.hs_hospital_master hhm on hhm.hospital_id=pvd.hospital_id JOIN  healthscore_dw.map_patient_hospital mph on mph.hospital_patient_cd=hpm.patient_cd and mph.hospital_cd=hhm.hs_hospital_cd_guid left JOIN  healthscore_dw.fact_patient_visits fpv on fpv.patient_key=mph.patient_key and fpv.visit_hospital_key=mph.hospital_key and fpv.hospital_patient_visit_id=pvd.patient_visit_id",
			"where_clause": "mph.hospital_key=%i",
			"update_fields": "patient_visit_key=src.patient_visit_key,created_staff_key=src.staff_key,clinical_info_desc=src.clinical_info_desc,effective_from_ts=src.effective_from_ts,effective_to_ts=src.effective_to_ts,recorded_date_key=src.recorded_date_key,recorded_time_key=src.recorded_time_key,active_flg=src.active_flg"
		},
		{
			"tablename": "fact_patient_clinical_info",
			"source_table": "hs_patient_visit_diagnosis",
			"fields": "patient_key,patient_visit_key,created_staff_key,clinical_info_type_cd,clinical_info_ref_id,clinical_info_desc,effective_from_ts,effective_to_ts,recorded_date_key,recorded_time_key,active_flg,source_cd,etl_load_id",
			"insert_query": "SELECT mph.patient_key, mph.patient_visit_key as patient_visit_key,visit_doctor_staff_key as staff_key,  'diagnosis', pvd.visit_diagnosis_id as clinical_info_ref_id, concat(healthscore_dw.fnStripTags(pvd.visit_diagnosis_desc)) as clinical_info_desc, pvd.created_ts as effective_from_ts,  CASE WHEN pvd.active_flg = 0 THEN pvd.modified_ts ELSE NULL END AS effective_to_ts,  date(pvd.created_ts) as recorded_date_key, time(pvd.created_ts) as recorded_time_key, pvd.active_flg ,'{0}',{1}   FROM healthscore_stg.hs_patient_visit_diagnosis pvd    JOIN  healthscore_dw.map_patient_visit_doctors mph on mph.hospital_visit_doctor_id=pvd.visit_doctor_id  and mph.source_cd = '{0}'",
			"where_clause": "mph.visit_hospital_key=%i",
			"update_fields": "patient_visit_key=src.patient_visit_key,created_staff_key=src.staff_key,clinical_info_ref_id=src.clinical_info_ref_id,clinical_info_desc=src.clinical_info_desc,effective_to_ts=src.effective_to_ts,recorded_date_key=src.recorded_date_key,recorded_time_key=src.recorded_time_key,active_flg=src.active_flg"
		},
		{
			"tablename": "fact_patient_visitbillitems",
			"source_table": "hs_patient_visit_bill_items",
			"fields": "src_visit_bill_item_id,patient_visitbill_key,bill_item_key,bill_item_qty, bill_item_unit_amt,bill_item_total_concession_amt,bill_item_final_amt, bill_item_receipt_cd,active_flg,pharmacy_item_flg,vbi_created_ts,vbi_date_key,vbi_time_key,payment_method_desc,bill_item_total_tax,bill_item_returned_qty,vbi_created_staff_key,vbi_modified_staff_key,payment_comments,non_editable_comments,patient_care_plan_instruction_key,prior_visit_bill_id,tax_type_nm,tax_value_in_per,item_pseudo_unit_amt,source_cd,etl_load_id",
			"insert_query": "SELECT pvbi.visit_bill_item_id,fpvb.patient_visitbill_key, dbi.bill_item_key, pvbi.bill_item_qty AS bill_item_qty, pvbi.bill_item_unit_amt AS bill_item_unit_amt, pvbi.bill_item_total_concession_amt AS bill_item_total_concession_amt, pvbi.bill_item_final_amt AS bill_item_final_amt, pvbi.bill_item_receipt_cd AS bill_item_receipt_cd, pvbi.active_flg, pvbi.pharmacy_item, pvbi.created_ts,Date(pvbi.created_ts) as vbi_date_key,Time(pvbi.created_ts) as vbi_time_key, pmm.payment_method_desc, pvbi.bill_item_total_tax, pvbi.returned_qty, ds_c.staff_key, ds_m.staff_key AS vbi_modified_staff_key, pvbi.payment_comments,pvbi.non_editable_comments,patient_careplan_instruction_key,pvbi.prior_visit_bill_id,tax_type_nm,tax_value_in_per,pvbi.item_pseudo_unit_amt,'{0}',{1} FROM healthscore_stg.hs_patient_visit_bill_items pvbi JOIN healthscore_dw.fact_patient_visitbills fpvb ON pvbi.visit_bill_id = fpvb.visit_bill_id AND source_cd = '{0}'  JOIN healthscore_dw.dim_bill_items dbi ON dbi.bill_item_id = pvbi.bill_item_id AND dbi.bill_item_type != 'consultation' AND dbi.hospital_key = fpvb.visit_hospital_key JOIN healthscore_dw.dim_staff ds_c ON ds_c.hospital_key = fpvb.visit_hospital_key AND ds_c.hospital_staff_user_nm = pvbi.created_by LEFT JOIN healthscore_stg.hs_hospital_payment_methods_master pmm on pvbi.payment_method_id = pmm.payment_method_id LEFT JOIN healthscore_stg.hs_tax_type_master ttm on pvbi.tax_type_id = ttm.tax_type_id LEFT JOIN     healthscore_dw.dim_staff ds_m ON ds_m.hospital_key = fpvb.visit_hospital_key AND ds_m.hospital_staff_user_nm = pvbi.modified_by left join healthscore_dw.fact_patient_careplan_instructions fpci on pvbi.care_plan_instruction_id = fpci.care_plan_instruction_id and fpci.source_cd = '{0}' ",
			"where_clause": "fpvb.visit_hospital_key=%i",
			"update_fields": "patient_visitbill_key=src.patient_visitbill_key,bill_item_key=src.bill_item_key, bill_item_qty=src.bill_item_qty,bill_item_unit_amt=src.bill_item_unit_amt, bill_item_total_concession_amt=src.bill_item_total_concession_amt,bill_item_final_amt=src.bill_item_final_amt, bill_item_receipt_cd=src.bill_item_receipt_cd,active_flg=src.active_flg,pharmacy_item_flg=src.pharmacy_item, vbi_created_ts=src.created_ts,vbi_date_key=src.vbi_date_key,vbi_time_key=src.vbi_time_key, payment_method_desc=src.payment_method_desc, bill_item_total_tax=src.bill_item_total_tax, bill_item_returned_qty=src.returned_qty,vbi_created_staff_key=src.staff_key, vbi_modified_staff_key=src.vbi_modified_staff_key,payment_comments=src.payment_comments,non_editable_comments=src.non_editable_comments, patient_care_plan_instruction_key=src.patient_careplan_instruction_key,prior_visit_bill_id=src.prior_visit_bill_id,item_pseudo_unit_amt=src.item_pseudo_unit_amt"
		},
		{
			"tablename": "fact_patient_visitbillitems",
			"source_table": "hs_patient_visit_bill_items-consultation",
			"fields": "src_visit_bill_item_id,patient_visitbill_key,bill_item_key,bill_item_qty, bill_item_unit_amt,bill_item_total_concession_amt,bill_item_final_amt, bill_item_receipt_cd,active_flg,pharmacy_item_flg,vbi_created_ts,vbi_date_key,vbi_time_key,payment_method_desc,bill_item_total_tax,bill_item_returned_qty,vbi_created_staff_key,vbi_modified_staff_key,payment_comments,non_editable_comments,patient_care_plan_instruction_key,prior_visit_bill_id,tax_type_nm,tax_value_in_per,item_pseudo_unit_amt,source_cd,etl_load_id",
			"insert_query": "SELECT pvbi.visit_bill_item_id, fpvb.patient_visitbill_key, dbi_con.bill_item_key,pvbi.bill_item_qty,  pvbi.bill_item_unit_amt,  pvbi.bill_item_total_concession_amt ,  pvbi.bill_item_final_amt ,  pvbi.bill_item_receipt_cd,  pvbi.active_flg,  pvbi.pharmacy_item,  pvbi.created_ts,date(pvbi.created_ts) as vbi_date_key, time(pvbi.created_ts) as vbi_time_key,  pmm.payment_method_desc,  pvbi.bill_item_total_tax,  pvbi.returned_qty,  ds_c.staff_key,  ds_m.staff_key AS vbi_modified_staff_key,pvbi.payment_comments,pvbi.non_editable_comments,patient_careplan_instruction_key,pvbi.prior_visit_bill_id,tax_type_nm,tax_value_in_per,pvbi.item_pseudo_unit_amt,'{0}',{1} FROM  healthscore_stg.hs_patient_visit_bill_items pvbi  JOIN  healthscore_dw.fact_patient_visitbills fpvb ON pvbi.visit_bill_id = fpvb.visit_bill_id and fpvb.source_cd = '{0}'  JOIN healthscore_dw.dim_bill_items dbi_con ON dbi_con.bill_item_id=pvbi.con_charge_id and dbi_con.bill_item_type='consultation'   AND dbi_con.hospital_key = fpvb.visit_hospital_key  JOIN  healthscore_dw.dim_staff ds_c ON ds_c.hospital_key = fpvb.visit_hospital_key  AND ds_c.hospital_staff_user_nm = pvbi.created_by  left join   healthscore_dw.dim_staff ds_m ON ds_m.hospital_key = fpvb.visit_hospital_key  AND ds_m.hospital_staff_user_nm = pvbi.modified_by left join healthscore_dw.fact_patient_careplan_instructions fpci on pvbi.care_plan_instruction_id = fpci.care_plan_instruction_id and fpci.source_cd = '{0}' LEFT JOIN healthscore_stg.hs_hospital_payment_methods_master pmm on pvbi.payment_method_id = pmm.payment_method_id LEFT JOIN healthscore_stg.hs_tax_type_master ttm on pvbi.tax_type_id = ttm.tax_type_id ",
			"where_clause": "fpvb.visit_hospital_key=%i",
			"update_fields": "patient_visitbill_key=src.patient_visitbill_key,bill_item_key=src.bill_item_key, bill_item_qty=src.bill_item_qty,bill_item_unit_amt=src.bill_item_unit_amt, bill_item_total_concession_amt=src.bill_item_total_concession_amt,bill_item_final_amt=src.bill_item_final_amt, bill_item_receipt_cd=src.bill_item_receipt_cd,active_flg=src.active_flg,pharmacy_item_flg=src.pharmacy_item, vbi_created_ts=src.created_ts,vbi_date_key=src.vbi_date_key,vbi_time_key=src.vbi_time_key,  payment_method_desc=src.payment_method_desc, bill_item_total_tax=src.bill_item_total_tax, bill_item_returned_qty=src.returned_qty,vbi_created_staff_key=src.staff_key, vbi_modified_staff_key=src.vbi_modified_staff_key,payment_comments=src.payment_comments,non_editable_comments=src.non_editable_comments, patient_care_plan_instruction_key=src.patient_careplan_instruction_key,prior_visit_bill_id=src.prior_visit_bill_id,item_pseudo_unit_amt=src.item_pseudo_unit_amt"
		},
		{
			"tablename": "fact_patient_visitbillitems",
			"source_table": "hs_patient_visit_bill_items-payment",
			"fields": "src_visit_bill_item_id,patient_visitbill_key,bill_item_key,bill_item_qty, bill_item_unit_amt,bill_item_total_concession_amt,bill_item_final_amt, bill_item_receipt_cd,active_flg,pharmacy_item_flg,vbi_created_ts,vbi_date_key,vbi_time_key,payment_method_desc,bill_item_total_tax,bill_item_returned_qty,vbi_created_staff_key,vbi_modified_staff_key,payment_comments,non_editable_comments,patient_care_plan_instruction_key,prior_visit_bill_id,tax_type_nm,tax_value_in_per,source_cd,etl_load_id,payment_last_cd,payment_approval_cd",
			"insert_query": "SELECT pvbi.visit_bill_item_id,fpvb.patient_visitbill_key,dbi.bill_item_key, pvbi.bill_item_qty, pvbi.bill_item_unit_amt, pvbi.bill_item_total_concession_amt, pvbi.bill_item_final_amt, pvbi.bill_item_receipt_cd, pvbi.active_flg, pvbi.pharmacy_item, pvbi.created_ts,date(pvbi.created_ts) as vbi_date_key,time(pvbi.created_ts) as vbi_time_key, pmm.payment_method_desc, pvbi.bill_item_total_tax, pvbi.returned_qty, ds_c.staff_key, ds_m.staff_key AS vbi_modified_staff_key, pvbi.payment_comments,pvbi.non_editable_comments,patient_careplan_instruction_key,pvbi.prior_visit_bill_id,tax_type_nm,tax_value_in_per,'{0}',{1},payment_last_cd,payment_approval_cd FROM healthscore_stg.hs_patient_visit_bill_items pvbi JOIN healthscore_dw.fact_patient_visitbills fpvb ON pvbi.visit_bill_id = fpvb.visit_bill_id and fpvb.source_cd = '{0}' JOIN healthscore_dw.dim_bill_items dbi ON dbi.bill_item_id = pvbi.bill_item_id and dbi.bill_item_type='bill_payment'  AND dbi.hospital_key = fpvb.visit_hospital_key JOIN healthscore_dw.dim_staff ds_c ON ds_c.hospital_key = fpvb.visit_hospital_key AND ds_c.hospital_staff_user_nm = pvbi.created_by left join  healthscore_dw.dim_staff ds_m ON ds_m.hospital_key = fpvb.visit_hospital_key AND ds_m.hospital_staff_user_nm = pvbi.modified_by  left join healthscore_dw.fact_patient_careplan_instructions fpci on pvbi.care_plan_instruction_id = fpci.care_plan_instruction_id and fpci.source_cd = '{0}' LEFT JOIN healthscore_stg.hs_hospital_payment_methods_master pmm on pvbi.payment_method_id = pmm.payment_method_id LEFT JOIN healthscore_stg.hs_tax_type_master ttm on pvbi.tax_type_id = ttm.tax_type_id LEFT JOIN healthscore_stg.hs_patient_visit_payment_details vpd on vpd.visit_bill_item_id = pvbi.visit_bill_item_id",
			"where_clause": "fpvb.visit_hospital_key=%i",
			"update_fields": "patient_visitbill_key=src.patient_visitbill_key,bill_item_key=src.bill_item_key, bill_item_qty=src.bill_item_qty,bill_item_unit_amt=src.bill_item_unit_amt, bill_item_total_concession_amt=src.bill_item_total_concession_amt,bill_item_final_amt=src.bill_item_final_amt, bill_item_receipt_cd=src.bill_item_receipt_cd,active_flg=src.active_flg,pharmacy_item_flg=src.pharmacy_item,vbi_created_ts=src.created_ts,vbi_date_key=src.vbi_date_key,vbi_time_key=src.vbi_time_key,payment_method_desc=src.payment_method_desc, bill_item_total_tax=src.bill_item_total_tax, bill_item_returned_qty=src.returned_qty,vbi_created_staff_key=src.staff_key, vbi_modified_staff_key=src.vbi_modified_staff_key,payment_comments=src.payment_comments,non_editable_comments=src.non_editable_comments, patient_care_plan_instruction_key=src.patient_careplan_instruction_key,prior_visit_bill_id=src.prior_visit_bill_id,tax_type_nm=src.tax_type_nm,tax_value_in_per=src.tax_value_in_per,payment_last_cd=src.payment_last_cd,payment_approval_cd=src.payment_approval_cd"
		},
		{
			"tablename": "fact_patient_visit_advice",
			"source_table": "hs_patient_visit_actions-advice",
			"fields": "patient_key ,  visit_doctor_staff_key , visit_hospital_key ,advice_desc, active_flg, note_created_ts ,  note_modified_ts , created_by_staff_key,  modified_by_staff_key,source_cd,etl_load_id",
			"insert_query": "SELECT patient_key,  visit_doctor_staff_key, visit_hospital_key,action_desc as advice_desc, pva.active_flg,pva.created_ts as note_created_ts ,pva.modified_ts as note_modified_ts,ds_c.staff_key,ds_m.staff_key as modified_by_staff_key,'{0}',{1} FROM healthscore_stg.hs_patient_visit_actions pva join healthscore_dw.map_patient_visit_doctors mpv on mpv.hospital_visit_doctor_id = pva.visit_doctor_id and mpv.source_cd='{0}' and pva.action_category_ref_component_id = 418043000   join healthscore_dw.dim_staff ds_c on ds_c.hospital_staff_user_nm=pva.created_by and ds_c.hospital_key=visit_hospital_key left join healthscore_dw.dim_staff ds_m on ds_m.hospital_staff_user_nm=pva.created_by and ds_m.hospital_key=visit_hospital_key",
			"where_clause": "visit_hospital_key=%i",
			"update_fields": "advice_desc=src.advice_desc, active_flg=src.active_flg, created_by_staff_key=src.staff_key, note_modified_ts=src.note_modified_ts, modified_by_staff_key=src.modified_by_staff_key"
		},
		{
			"tablename": "fact_patient_assessments",
			"source_table": "hs_patient_assessment",
			"fields": "patient_key , visit_hospital_key , patient_visit_key , patient_assessment_id , assessment_scale_master_id , assessment_scale_desc , hospital_dept_nm  , assessed_date_key , assessed_time_key  , assessed_ts  , visit_assessment_status_flg  , deactivation_comment , active_flg  , source_cd , etl_load_id",
			"insert_query": "select mph.patient_key,mph.hospital_key,fpv.patient_visit_key,pas.hs_patient_assessment_id,asm.health_assessment_scale_id, asm.health_assessment_scale_desc,dept.dept_name, date(pas.assessed_ts) as assessed_date_key,time(pas.assessed_ts) as assessed_time_key,pas.assessed_ts, pas.visit_assessment_status_flg , pas.deactivation_comment , pas.active_flg ,'{0}',{1} from healthscore_stg.hs_patient_assessment pas join healthscore_stg.hs_health_assessment_scale_master asm on asm.health_assessment_scale_id = pas.health_assessment_scale_id join healthscore_stg.hs_hospital_primary_dept_master dept on asm.dept_id = dept.dept_id JOIN healthscore_stg.hs_patient_master hpm ON hpm.patient_id = pas.patient_id JOIN healthscore_stg.hs_hospital_master hhm ON hhm.hospital_id = pas.hospital_id JOIN healthscore_dw.map_patient_hospital mph ON mph.hospital_patient_cd = hpm.patient_cd AND mph.hospital_cd = hhm.hs_hospital_cd_guid JOIN healthscore_dw.fact_patient_visits fpv ON fpv.patient_key = mph.patient_key AND fpv.visit_hospital_key = mph.hospital_key AND fpv.hospital_patient_visit_id = pas.patient_visit_id ",
			"where_clause": "fpv.visit_hospital_key=%i",
			"update_fields": "hospital_dept_nm=src.dept_name,assessment_scale_desc=src.health_assessment_scale_desc,assessed_date_key=src.assessed_date_key,assessed_time_key = src.assessed_time_key , assessed_ts =src.assessed_ts , visit_assessment_status_flg = src.visit_assessment_status_flg, deactivation_comment = src.deactivation_comment , active_flg=src.active_flg  "
		},
		{
			"tablename": "fact_patient_assessment_results",
			"source_table": "hs_patient_assessment_scale_results",
			"fields": "patient_assmt_key, patient_assessment_result_id, assessment_result_item_master_id, result_item_display_txt , result_item_value  , result_item_ref_range_txt, result_item_row_no, result_item_column_no, result_item_min_value , result_item_max_value, active_flg , source_cd , etl_load_id ",
			"insert_query": "select pas.patient_assmt_key, par.hs_patient_assessment_scale_result_id,par.assessment_scale_result_item_id,asr.ref_display_txt as result_item_display_txt, case when asr.ref_display_txt ='BMI' then bmi.bmi_value else replace(par.assessment_scale_result_value,'`','') end as result_item_value, asr.component_reference_range_txt as result_item_ref_range_txt,asr.row_no as result_item_row_no,asr.column_no as result_item_column_no, asr.min_value as result_item_min_value,asr.max_value as result_item_max_value,asr.active_flg,'{0}',{1} from healthscore_dw.fact_patient_assessments pas  join healthscore_stg.hs_patient_assessment_scale_results par on pas.patient_assessment_id=par.hs_patient_assessment_id and pas.source_cd = '{0}' join healthscore_stg.hs_health_assessment_scale_result_items_master asr on pas.assessment_scale_master_id = asr.health_assessment_scale_id and asr.assessment_scale_result_item_id = par.assessment_scale_result_item_id left join ( select patient_assmt_key,case when ht <> 0 then round(wt/(ht*ht),2) else 0 end as bmi_value from  ( SELECT pas.patient_assmt_key,  sum(case when ref_display_txt = 'Height (cm)' then cast(coalesce(replace(assessment_scale_result_value,'`',''),0) as UNSIGNED)/100 else 0 end) as ht, sum(case when ref_display_txt = 'Weight (kg)' then cast(coalesce(replace(assessment_scale_result_value,'`',''),0) as UNSIGNED) else 0 end) as wt  FROM healthscore_dw.fact_patient_assessments pas JOIN healthscore_stg.hs_patient_assessment_scale_results par ON pas.patient_assessment_id = par.hs_patient_assessment_id and pas.source_cd = '{0}'  JOIN healthscore_stg.hs_health_assessment_scale_result_items_master asr ON pas.assessment_scale_master_id = asr.health_assessment_scale_id AND asr.assessment_scale_result_item_id = par.assessment_scale_result_item_id  where length(assessment_scale_result_value)>0  group by pas.patient_assmt_key  ) a) bmi  on bmi.patient_assmt_key = pas.patient_assmt_key ",
			"where_clause": "pas.visit_hospital_key=%i",
			"update_fields": "result_item_display_txt=src.result_item_display_txt,result_item_value=src.result_item_value,result_item_ref_range_txt=src.result_item_ref_range_txt,result_item_row_no=src.result_item_row_no,result_item_column_no=src.result_item_column_no,result_item_min_value=src.result_item_min_value,result_item_max_value = src.result_item_max_value,active_flg=src.active_flg"
		},
		{
			"tablename": "fact_patient_careplans",
			"source_table": "hs_patient_visit_care_plan",
			"fields": "patient_key,careplan_id,visit_hospital_key,created_visit_key,careplan_status_cd,careplan_status_nm,careplan_summary,active_flg,created_by_staff_key,modified_by_staff_key,careplan_created_date_key,careplan_created_time_key,careplan_created_ts,careplan_modified_date_key,careplan_modified_time_key,careplan_modified_ts,source_cd,etl_load_id",
			"insert_query": "select fpv.patient_key,svcp.care_plan_id careplan_id,fpv.visit_hospital_key,fpv.patient_visit_key as created_visit_key,scpsm.care_plan_status_cd careplan_status_cd ,scpsm.care_plan_status_nm careplan_status_nm,svcp.careplan_summary,svcp.active_flg,ds_c.staff_key as created_by_staff_key,  ds_m.staff_key as modified_by_staff_key,date(svcp.created_ts) as careplan_created_date_key,time(svcp.created_ts) as careplan_created_time_key,svcp.created_ts as careplan_created_ts,date(svcp.modified_ts) as careplan_modified_date_key,time(svcp.modified_ts) as careplan_modified_time_key,svcp.modified_ts as careplan_modified_ts,'{0}',{1} from healthscore_stg.hs_patient_visit_care_plan svcp join healthscore_dw.fact_patient_visits fpv on fpv.hospital_patient_visit_id = svcp.created_visit_id and source_cd ='{0}' join healthscore_stg.hs_care_plan_status scpsm on scpsm.care_plan_status_id=svcp.care_plan_status_id left join healthscore_dw.dim_staff ds_c on ds_c.hospital_key = fpv.visit_hospital_key and ds_c.hospital_staff_user_nm = svcp.created_by  left join healthscore_dw.dim_staff ds_m on ds_m.hospital_key = fpv.visit_hospital_key and ds_m.hospital_staff_user_nm = svcp.modified_by ",
			"where_clause": "fpv.visit_hospital_key=%i",
			"update_fields": "careplan_status_cd=src.careplan_status_cd,careplan_status_nm=src.careplan_status_nm,careplan_summary=src.careplan_summary,active_flg=src.active_flg,modified_by_staff_key=src.modified_by_staff_key,careplan_modified_date_key = src.careplan_modified_date_key,careplan_modified_time_key = src.careplan_modified_time_key,careplan_modified_ts = src.careplan_modified_ts"
		},
		{
			"tablename": "fact_patient_careplan_instructions",
			"source_table": "hs_patient_visit_care_plan_instructions",
			"fields": "care_plan_instruction_id,careplan_instruction_master_key,freq_mode_cd,freq_mode_nm,careplan_ins_status_cd,careplan_ins_status_nm,freq_num,ins_started_ts,ins_ended_ts,comments,created_by_staff_key,modified_by_staff_key,feed_qty,total_feed,interval_no,feed_increase_qty,feed_increase_freq_in_hrs,first_feed_ins_start_ts,stopped_flg,active_flg,ins_created_date_key,ins_created_time_key,ins_created_ts,bill_item_key,patient_careplan_key,patient_medication_key,ventilation_ins_detail,etl_load_id,source_cd",
			"insert_query": "select scpi.care_plan_instruction_id,dcpim.careplan_instruction_master_key,sfmm.freq_mode_cd,sfmm.freq_mode_nm,scpis.status_cd careplan_ins_status_cd,scpis.status_nm careplan_ins_status_nm,scpi.freq_num,scpi.started_ts ins_started_ts,scpi.ended_ts ins_ended_ts,scpi.comments,ds_c.staff_key created_by_staff_key,ds_m.staff_key modified_by_staff_key,scpi.feed_qty,scpi.total_feed,scpi.interval_no,scpi.feed_increase_qty,scpi.feed_increase_freq_in_hrs,scpi.first_feed_ins_start_ts,scpi.stopped_flg,scpi.active_flg,date(scpi.created_ts) ins_created_date_key,time(scpi.created_ts) ins_created_time_key,scpi.created_ts ins_created_ts,case when scpi.bill_item_id is not null then dbi.bill_item_key  else dcbi.bill_item_key end as bill_item_key,fcp.patient_careplan_key,dpm.patient_medication_key,sven.ventilation_details ventilation_ins_detail,{1},'{0}' from healthscore_stg.hs_patient_visit_care_plan_instructions scpi  join healthscore_dw.fact_patient_careplans fcp on fcp.careplan_id = scpi.care_plan_id and fcp.source_cd='{0}' left join healthscore_dw.dim_careplan_instruction_master dcpim on dcpim.instruction_id = scpi.instruction_master_id and dcpim.hospital_key=fcp.visit_hospital_key left join healthscore_stg.hs_frequency_mode_master sfmm on sfmm.freq_mode_id = scpi.freq_mode_id  left join healthscore_stg.hs_care_plan_instruction_status scpis on scpis.status_id = scpi.status_id left join healthscore_dw.dim_staff ds_c on ds_c.hospital_key = fcp.visit_hospital_key  and ds_c.hospital_staff_user_nm = scpi.created_by left join  healthscore_dw.dim_staff ds_m on ds_m.hospital_key = fcp.visit_hospital_key and ds_m.hospital_staff_user_nm = scpi.modified_by  left join healthscore_dw.dim_bill_items dbi on dbi.bill_item_id = scpi.bill_item_id and dbi.bill_item_type = 'bill_item' and dbi.hospital_key = fcp.visit_hospital_key  left join healthscore_dw.dim_bill_items dcbi on dcbi.bill_item_id = scpi.con_charge_id and dcbi.bill_item_type = 'consultation' and dcbi.hospital_key = fcp.visit_hospital_key left join (select  scvd.care_plan_instruction_id,json_object('mode_name', svmm.ventilator_mode_nm, 'setting_value', group_concat(svsm.ventilator_settings_nm, ':', case when  scvd.ventilator_settings_value is not null and trim(scvd.ventilator_settings_value) <> '' then   concat(coalesce(scvd.ventilator_settings_value, '0'), coalesce(svsm.refmeasuredisplaytxt, ''))  end)) as ventilation_details  from   healthscore_stg.hs_patient_visit_careplan_ventilator_details scvd join healthscore_stg.hs_ventilator_mode_master svmm on svmm.ventilator_mode_id = scvd.ventilator_mode_id join healthscore_stg.hs_ventilator_settings_master svsm on svsm.ventilator_settings_id = scvd.ventilator_settings_id group by scvd.care_plan_instruction_id , scvd.ventilator_mode_id,svmm.ventilator_mode_nm) sven on sven.care_plan_instruction_id = scpi.care_plan_instruction_id left join healthscore_dw.fact_patient_medications dpm on dpm.medication_details_id = scpi.medication_details_id and dpm.prescribed_hospital_key=fcp.visit_hospital_key",
			"where_clause": "fcp.visit_hospital_key=%i",
			"update_fields": "freq_mode_cd=src.freq_mode_cd,freq_mode_nm=src.freq_mode_nm,careplan_ins_status_cd=src.careplan_ins_status_cd,careplan_ins_status_nm=src.careplan_ins_status_nm,freq_num=src.freq_num,ins_started_ts=src.ins_started_ts,ins_ended_ts=src.ins_ended_ts,comments=src.comments,created_by_staff_key=src.created_by_staff_key,modified_by_staff_key=src.modified_by_staff_key,feed_qty=src.feed_qty,total_feed=src.total_feed,interval_no=src.interval_no,feed_increase_qty=src.feed_increase_qty,feed_increase_freq_in_hrs=src.feed_increase_freq_in_hrs,first_feed_ins_start_ts=src.first_feed_ins_start_ts,stopped_flg=src.stopped_flg,active_flg=src.active_flg, ins_created_date_key=src.ins_created_date_key,ins_created_time_key=src.ins_created_time_key,ins_created_ts=src.ins_created_ts,bill_item_key=src.bill_item_key, patient_medication_key=src.patient_medication_key,ventilation_ins_detail=src.ventilation_ins_detail"
		},
		{
			"tablename": "fact_hospital_daily_statistics",
			"source_table": "hs_hospital_daily_statistics",
			"fields": "hospital_key,in_patient_cnt,out_patient_cnt,in_patient_admission_cnt,in_patient_checkout_cnt,out_patient_checkout_cnt,in_patient_avg_stay,as_of_date,source_cd,etl_load_id",
			"insert_query": "select dh.hospital_key,shds.in_patient_cnt,shds.out_patient_cnt,shds.in_patient_admission_cnt,shds.in_patient_checkout_cnt,shds.out_patient_checkout_cnt,shds.in_patient_avg_stay,shds.as_of_date,'{0}',{1} from healthscore_stg.hs_hospital_daily_statistics shds join healthscore_stg.hs_hospital_master shm  on shm.hospital_id=shds.hospital_master_id join healthscore_dw.dim_hospital dh on dh.hospital_cd = shm.hs_hospital_cd_guid and dh.source_cd='{0}'",
			"where_clause": "dh.hospital_key=%i",
			"update_fields": "in_patient_cnt=src.in_patient_cnt,out_patient_cnt=src.out_patient_cnt,in_patient_admission_cnt=src.in_patient_admission_cnt,in_patient_checkout_cnt=src.in_patient_checkout_cnt,out_patient_checkout_cnt=src.out_patient_checkout_cnt,in_patient_avg_stay=src.in_patient_avg_stay"
		},
		{
			"tablename": "fact_active_visits",
			"source_table": "vw_patient_active_visits",
			"fields": "as_of_date_key,patient_visit_key,patient_key,hospital_key,daily_rate,billed_days,ward_nm,admitted_days,total_paid_amt,total_refund_amt,total_waived_amt,total_billed_amt,unbilled_consumables_amt,unbilled_canteen_amt,previous_bill_balance_amt,current_balance_amt,critical_flg,source_cd,etl_load_id",
			"insert_query": "select pav.as_of_date,fpv.patient_visit_key,fpv.patient_key,fpv.visit_hospital_key,coalesce(pav.daily_rate,0) as daily_rate,pav.billed_days,pav.ward_nm,pav.admitted_days,pav.total_paid_amt, pav.total_refund_amt, pav.total_waived_amt, pav.total_billed_amt, coalesce(vi_cons.unbilled_consumables_amt,0) as unbilled_consumables_amt,pav.unbilled_canteen as unbilled_canteen_amt,coalesce(pav.bill_balance_amt,0) as previous_bill_balance_amt,coalesce(pav.total_billed_amt,0) - coalesce(pav.total_paid_amt,0) + coalesce(pav.bill_balance_amt,0) as current_balance_amt,pav.critical_flg as critical_flg,'{0}',{1} from healthscore_stg.vw_patient_active_visits pav join healthscore_dw.fact_patient_visits fpv on pav.patient_visit_id = fpv.hospital_patient_visit_id and fpv.source_cd = '{0}' left join healthscore_stg.vw_patient_visit_unbilled_consumables vi_cons on vi_cons.hospital_master_id=pav.hospital_id and vi_cons.patient_visit_id=pav.patient_visit_id",
			"where_clause": "fpv.visit_hospital_key=%i",
			"update_fields": "daily_rate=src.daily_rate,billed_days=src.billed_days,ward_nm=src.ward_nm,admitted_days=src.admitted_days,total_paid_amt=src.total_paid_amt, total_refund_amt=src.total_refund_amt, total_waived_amt=src.total_waived_amt, total_billed_amt=src.total_billed_amt, unbilled_consumables_amt=src.unbilled_consumables_amt,unbilled_canteen_amt=src.unbilled_canteen_amt,previous_bill_balance_amt=src.previous_bill_balance_amt,current_balance_amt=src.current_balance_amt,critical_flg=src.critical_flg"
		},
		{
			"tablename": "fact_patient_careplan_execution_details",
			"source_table": "vw_patient_visit_careplan_instruction_details",
			"fields": "patient_careplan_instruction_key, patient_careplan_key, careplan_instruction_details_id, care_plan_instruction_id, careplan_instruction_master_key, recorded_ts, infusion_rate, input_output_volume, feed_route_nm, input_output_type_nm, input_output_type_measurement_ref_text, input_output_type_category, ventilator_mode_nm, ventilator_settings_nm, ventilator_uom_nm, ventilator_allowed_lower_limit, ventilator_allowed_upper_limit, ventilator_settings_value, source_cd, etl_load_id ",
			"insert_query": "select patient_careplan_instruction_key, cpi.patient_careplan_key, careplan_instruction_details_id, cpid.care_plan_instruction_id, careplan_instruction_master_key, recorded_ts, infusion_rate, input_output_volume, feed_route_nm, input_output_type_nm, input_output_type_measurement_ref_text, input_output_type_category, ventilator_mode_nm, ventilator_settings_nm, refMeasureDisplayTxt as ventilator_uom_nm, allowed_lower_limit as ventilator_allowed_lower_limit, allowed_upper_limit as ventilator_allowed_upper_limit, ventilator_settings_value,'{0}',{1} from healthscore_stg.vw_patient_visit_careplan_instruction_details cpid join healthscore_dw.fact_patient_careplan_instructions cpi on cpid.care_plan_instruction_id = cpi.care_plan_instruction_id and cpi.source_cd = '{0}' join healthscore_dw.fact_patient_careplans cp on cpi.patient_careplan_key = cp.patient_careplan_key",
			"where_clause": "cp.visit_hospital_key=%i",
			"update_fields": "careplan_instruction_master_key=src.careplan_instruction_master_key, recorded_ts=src.recorded_ts, infusion_rate=src.infusion_rate, input_output_volume=src.input_output_volume, feed_route_nm=src.feed_route_nm, input_output_type_nm=src.input_output_type_nm, input_output_type_measurement_ref_text=src.input_output_type_measurement_ref_text, input_output_type_category=src.input_output_type_category, ventilator_mode_nm=src.ventilator_mode_nm, ventilator_settings_nm=src.ventilator_settings_nm,  ventilator_uom_nm=src.ventilator_uom_nm,  ventilator_allowed_lower_limit=src.ventilator_allowed_lower_limit, ventilator_allowed_upper_limit=src.ventilator_allowed_upper_limit, ventilator_settings_value=src.ventilator_settings_value"
		},
		{
			"tablename": "fact_patient_timeline_info",
			"source_table": "vw_patient_visit_progress_timeline_events",
			"fields": "patient_key, patient_visit_key,created_staff_key, progress_timeline_id,timeline_info_type_cd,timeline_info_hashtag_category,timeline_info_desc, patient_careplan_instruction_key, patient_careplan_key, careplan_instruction_master_key, careplan_activity_milestone_flg,careplan_activity_status,timeline_info_created_ts,timeline_info_modified_ts,active_flg,source_cd, etl_load_id",
			"insert_query": "SELECT fpv.patient_key,fpv.patient_visit_key,ds_c.staff_key AS created_staff_key,patient_visit_progress_timeline_event_id AS progress_timeline_id,'event' AS timeline_info_type_cd,ptl_ev.event_title as timeline_info_hashtag_category,ptl_ev.event_desc as timeline_info_desc,fct_pci.patient_careplan_instruction_key patient_careplan_instruction_key,fct_pci.patient_careplan_key patient_careplan_key,fct_pci.careplan_instruction_master_key careplan_instruction_master_key,ptl_ev.careplan_activity_milestone_flg careplan_activity_milestone_flg,ptl_ev.status_nm as careplan_activity_status,ptl_ev.created_ts as timeline_info_created_ts,ptl_ev.modified_ts as timeline_info_modified_ts,ptl_ev.active_flg,'{0}',{1} FROM healthscore_stg.vw_patient_visit_progress_timeline_events ptl_ev join healthscore_stg.hs_hospital_master stg_hm on ptl_ev.hospital_id=stg_hm.hospital_id join healthscore_dw.dim_hospital dm_hos on stg_hm.hs_hospital_cd_guid = dm_hos.hospital_cd JOIN healthscore_dw.fact_patient_visits fpv ON ptl_ev.patient_visit_id = fpv.hospital_patient_visit_id and fpv.source_cd='{0}' LEFT JOIN healthscore_dw.dim_staff ds_c ON ds_c.hospital_key = fpv.visit_hospital_key AND ds_c.hospital_staff_user_nm = ptl_ev.created_by LEFT JOIN healthscore_dw.fact_patient_careplans fct_pcp ON fct_pcp.careplan_id = ptl_ev.care_plan_id AND fct_pcp.visit_hospital_key = dm_hos.hospital_key LEFT JOIN healthscore_dw.fact_patient_careplan_instructions fct_pci ON fct_pci.care_plan_instruction_id = ptl_ev.careplan_activity_id and fct_pcp.patient_careplan_key=fct_pci.patient_careplan_key",
			"where_clause": "dm_hos.hospital_key=%i",
			"update_fields": "patient_key=src.patient_key, patient_visit_key=src.patient_visit_key,created_staff_key=src.created_staff_key, progress_timeline_id=src.progress_timeline_id,timeline_info_type_cd=src.timeline_info_type_cd,timeline_info_hashtag_category=src.timeline_info_hashtag_category,timeline_info_desc=src.timeline_info_desc, patient_careplan_instruction_key=src.patient_careplan_instruction_key, patient_careplan_key=src.patient_careplan_key, careplan_instruction_master_key=src.careplan_instruction_master_key, careplan_activity_milestone_flg=src.careplan_activity_milestone_flg,careplan_activity_status=src.careplan_activity_status,timeline_info_created_ts=src.timeline_info_created_ts,timeline_info_modified_ts=src.timeline_info_modified_ts,active_flg=src.active_flg"
		},
		{
			"tablename": "fact_patient_timeline_info",
			"source_table": "vw_patient_visit_progress_timeline_notes",
			"fields": "patient_key, patient_visit_key,created_staff_key, progress_timeline_id,timeline_info_type_cd,timeline_info_hashtag_category, timeline_info_desc,timeline_info_created_ts,timeline_info_modified_ts,active_flg,source_cd, etl_load_id",
			"insert_query": "SELECT fpv.patient_key as patient_key,fpv.patient_visit_key patient_visit_key,ds_c.staff_key as created_staff_key,ptl_notes.progress_timeline_note_id as progress_timeline_id,'note' as timeline_info_type_cd,ptl_notes.note_hashtag_nm AS timeline_info_hashtag_category,ptl_notes.progress_timeline_note_desc as timeline_info_desc,ptl_notes.created_ts as timeline_info_created_ts,ptl_notes.modified_ts as timeline_info_modified_ts,ptl_notes.active_flg,'{0}',{1} FROM healthscore_stg.vw_patient_visit_progress_timeline_notes ptl_notes join healthscore_dw.fact_patient_visits fpv on ptl_notes.patient_visit_id = fpv.hospital_patient_visit_id left join healthscore_dw.dim_staff ds_c on ds_c.hospital_key = fpv.visit_hospital_key  and ds_c.hospital_staff_user_nm = ptl_notes.created_by ",
			"where_clause": "fpv.visit_hospital_key=%i",
			"update_fields": "patient_key=src.patient_key, patient_visit_key=src.patient_visit_key,created_staff_key=src.created_staff_key, progress_timeline_id=src.progress_timeline_id,timeline_info_type_cd=src.timeline_info_type_cd,timeline_info_hashtag_category=src.timeline_info_hashtag_category, timeline_info_desc=src.timeline_info_desc, timeline_info_created_ts=src.timeline_info_created_ts,timeline_info_modified_ts=src.timeline_info_modified_ts,active_flg=src.active_flg"
		},
		{
			"tablename": "fact_consultant_appointment_schedule",
			"source_table": "hs_consultant_schedule_master",
			"fields": "hospital_key, consulting_staff_key, schedule_date_key, schedule_start_time_key, schedule_end_time_key ,consultant_schedule_id, duration, active_flg,  timeslot_usage_limit,  timeslot_used_cnt , schedule_created_ts , schedule_modified_ts , source_cd , etl_load_id ",
			"insert_query": "select dh.hospital_key , ds.staff_key as consulting_staff_key, schedule_dt as schedule_date_key, concat(schedule_hour_id,':',schedule_minute_id) schedule_start_time_key, concat(schedule_end_hour_id,':',schedule_end_minute_id) schedule_end_time_key,consultant_schedule_id, duration, stg.active_flg, timeslot_usage_limit,timeslot_used_cnt,  stg.created_ts schedule_created_ts, stg.modified_ts schedule_modified_ts,'{0}',{1} from `healthscore_stg`.`hs_consultant_schedule_master` stg  join healthscore_stg.hs_hospital_master hm  on stg.hospital_id = hm.hospital_id join healthscore_dw.dim_hospital dh on hm.hs_hospital_cd_guid = dh.hospital_cd  JOIN healthscore_dw.dim_staff ds ON ds.hospital_key = dh.hospital_key  AND ds.hospital_staff_id = stg.hospital_staff_id",
			"where_clause": "dh.hospital_key=%i",
			"update_fields": "schedule_end_time_key = src.schedule_end_time_key , duration = src.duration, active_flg = src.active_flg,  timeslot_usage_limit = src.timeslot_usage_limit,  timeslot_used_cnt = src.timeslot_used_cnt ,  schedule_modified_ts = src.schedule_modified_ts  "
		},
		{
			"tablename": "fact_patient_appointments",
			"source_table": "hs_patient_appointments_master",
			"fields": "patient_key, consultant_schedule_key, hospital_key, patient_appointment_id , schedule_status, visit_type, contact_type, appointment_status ,  appointment_created_ts, appointment_modified_ts, patient_visit_key,reason_txt,  source_cd, etl_load_id",
			"insert_query": "select mph.patient_key, cas.consultant_schedule_key,cas.hospital_key, pam.patient_appointment_id ,schedule_status_desc as schedule_status,  case when pam.visit_type = '' then 'in person' else lower(pam.visit_type) end  as visit_type,pam.contact_type, CASE WHEN pam.contact_type IS NULL AND pam.visit_type IS NULL THEN 'AVAILABLE' ELSE IFNULL(status,'FULFILLED') END  as appointment_status, pam.created_ts as appointment_created_ts, pam.modified_ts as appointment_modified_ts,fpv.patient_visit_key,pam.reason_txt reason_txt,'{0}',{1}  from healthscore_stg.hs_patient_appointments_master pam join healthscore_dw.fact_consultant_appointment_schedule cas on pam.consultant_schedule_id = cas.consultant_schedule_id join healthscore_dw.map_patient_hospital mph on mph.hospital_patient_id = pam.patient_id and cas.hospital_key = mph.hospital_key join healthscore_stg.hs_hospital_master hm  on mph.hospital_cd= hm.hs_hospital_cd_guid join healthscore_stg.hs_schedule_status_master ssm on pam.schedule_status_id = ssm.schedule_status_id left join fact_patient_visits fpv on pam.visit_id=fpv.hospital_patient_visit_id and cas.hospital_key= fpv.visit_hospital_key",
			"where_clause": "mph.hospital_key=%i",
			"update_fields": " schedule_status = src.schedule_status , appointment_status = src.appointment_status, visit_type = src.visit_type,  contact_type = src.contact_type,  appointment_created_ts = src.appointment_created_ts ,  appointment_modified_ts = src.appointment_modified_ts, patient_visit_key = src.patient_visit_key,reason_txt=src.reason_txt  "
		},
		{
			"tablename": "fact_content_info",
			"source_table": "content_action_log",
			"fields": "patient_key, hospital_key, content_key, viewed_ts, viewed_date_key, source_cd, etl_load_id",
			"insert_query": "SELECT mph.patient_key, mph.hospital_key, dim_c.content_key, c.created_ts as viewed_ts, date(c.created_ts) viewed_date_key,'{0}',{1} from healthscore_stg.content_action_log c join healthscore_dw.map_patient_hospital  mph on mph.hospital_patient_cd = c.user_id join healthscore_dw.dim_content dim_c on c.shared_content_id = dim_c.shared_content_id and dim_c.hospital_key = mph.hospital_key",
			"where_clause": "mph.hospital_key=%i",
			"update_fields": "viewed_ts = src.viewed_ts, viewed_date_key=src.viewed_date_key"
		},
		{
			"tablename": "fact_daily_stock_transactions",
			"source_table": "hs_stock_transactions",
			"fields": "transaction_date_key, hospital_key, product_batch_key, store_key, stock_transaction_id, transaction_type_cd, transaction_type_nm, adjustment_status_cd, transaction_qty,stock_transactions_comment, source_cd, etl_load_id",
			"insert_query": "SELECT DATE(st.created_ts) AS transaction_date_key, dp.hospital_key, pb.product_batch_key, ds.store_key, st.stock_transactions_id, stt.stock_transaction_type_cd as transaction_type_cd, stt.stock_transaction_type_nm as transaction_type_nm,  sas.adjustment_status_cd, st.stock_transactions_qty AS transaction_qty, stock_transactions_comment, '{0}',{1}  FROM healthscore_stg.hs_stock_transactions st JOIN healthscore_dw.dim_store ds ON ds.store_id = st.hospital_store_master_id and ds.source_cd = '{0}' JOIN healthscore_dw.dim_product dp ON dp.product_id = st.product_master_id and ds.hospital_key=dp.hospital_key JOIN healthscore_dw.dim_product_batch pb ON pb.product_key = dp.product_key and pb.stock_batch_no = st.stock_batch_no JOIN healthscore_stg.hs_stock_transaction_type stt ON stt.stock_transaction_type_id = st.transaction_type_id  LEFT JOIN healthscore_stg.hs_stock_adjustment_status sas ON sas.adjustment_status_id = st.adjustment_status_id",
			"where_clause": "dp.hospital_key=%i",
			"update_fields": " transaction_date_key = src.transaction_date_key, product_batch_key = src.product_batch_key, store_key = src.store_key, transaction_type_cd = src.transaction_type_cd, transaction_type_nm = src.transaction_type_nm, adjustment_status_cd  = src.adjustment_status_cd, transaction_qty = src.transaction_qty, stock_transactions_comment = src.stock_transactions_comment "
		},
		{
			"tablename": "fact_purchase_orders",
			"source_table": "hs_hospital_purchase_orders",
			"fields": "purchase_order_date_key, hospital_key, vendor_key, store_key, purchase_order_id, purchase_order_cd, purchase_order_amt, purchase_order_status_id, active_flg, source_cd, etl_load_id ",
			"insert_query": "SELECT DATE(hpo.created_ts) AS purchase_order_date_key, ds.hospital_key, dv.vendor_key, ds.store_key, hpo.purchase_order_id, hpo.purchase_order_cd, hpo.purchase_order_amt, hpo.purchase_order_status_id, hpo.active_flg,'{0}', {1}  FROM healthscore_stg.hs_hospital_purchase_orders hpo JOIN healthscore_dw.dim_store ds ON ds.store_id = hpo.hospital_store_master_id AND ds.source_cd= '{0}' JOIN healthscore_dw.dim_vendor dv ON dv.vendor_id = hpo.vendor_master_id AND dv.source_cd= '{0}' ",
			"where_clause": "ds.hospital_key=%i",
			"update_fields": " purchase_order_date_key = src.purchase_order_date_key, vendor_key = src.vendor_key, store_key = src.store_key, purchase_order_cd = src.purchase_order_cd, purchase_order_amt = src.purchase_order_amt, purchase_order_status_id = src.purchase_order_status_id, active_flg = src.active_flg "
		},
		{
			"tablename": "fact_purchase_order_invoices",
			"source_table": "hs_hospital_purchase_order_invoice_items",
			"fields": "purchase_order_key, invoice_date_key, hospital_key, product_batch_key, invoice_item_id, purchase_order_invoice_id,  purchase_order_invoice_no, invoice_item_qty, invoice_item_batch_no, invoice_item_expiry_ts, invoice_item_mrp_amt, invoice_item_tax_amt, invoice_item_unit_cost_amt, invoice_item_amt, discount_amount, invoice_item_return_qty, invoice_item_return_dt, active_flg, source_cd , etl_load_id",
			"insert_query": " SELECT fpo.purchase_order_key, DATE(poid.purchase_order_invoice_ts) AS invoice_date_key, pb.hospital_key, pb.product_batch_key, hpoi.invoice_item_id , poid.purchase_order_invoice_id, poid.purchase_order_invoice_no, hpoi.invoice_item_qty, hpoi.invoice_item_batch_no, hpoi.invoice_item_expiry_ts, hpoi.invoice_item_mrp_amt, hpoi.invoice_item_tax_amt,  hpoi.invoice_item_unit_cost_amt, hpoi.invoice_item_amt,  hpoi.discount_amount, hpoi.invoice_item_return_qty, hpoi.invoice_item_return_dt, hpoi.active_flg,'{0}',{1} FROM healthscore_stg.hs_hospital_purchase_order_invoice_items hpoi JOIN healthscore_stg.hs_hospital_purchase_order_invoice_details poid ON poid.purchase_order_invoice_id = hpoi.purchase_order_invoice_id JOIN healthscore_dw.fact_purchase_orders fpo ON fpo.purchase_order_id = poid.purchase_order_id AND source_cd = '{0}' JOIN healthscore_dw.dim_product dp ON dp.product_id = hpoi.product_master_id AND fpo.hospital_key = dp.hospital_key JOIN healthscore_dw.dim_product_batch pb ON pb.product_key = dp.product_key AND pb.stock_batch_no = hpoi.invoice_item_batch_no ",
			"where_clause": "fpo.hospital_key=%i",
			"update_fields": " purchase_order_key = src.purchase_order_key, invoice_date_key = src.invoice_date_key, product_batch_key = src.product_batch_key, purchase_order_invoice_id = src.purchase_order_invoice_id, purchase_order_invoice_no = src.purchase_order_invoice_no, invoice_item_qty = src.invoice_item_qty, invoice_item_batch_no = src.invoice_item_batch_no, invoice_item_expiry_ts = src.invoice_item_expiry_ts, invoice_item_mrp_amt = src.invoice_item_mrp_amt, invoice_item_tax_amt = src.invoice_item_tax_amt, invoice_item_unit_cost_amt = src.invoice_item_unit_cost_amt, invoice_item_amt = src.invoice_item_amt, discount_amount = src.discount_amount, invoice_item_return_qty = src.invoice_item_return_qty, invoice_item_return_dt = src.invoice_item_return_dt, active_flg = src.active_flg"
		},
		{
			"tablename": "fact_patient_consumables",
			"source_table": "hs_patient_visit_consumable_items",
			"fields": "hospital_key, patient_visit_key, patient_key, product_key, store_key, product_batch_key, consumable_added_staff_key, consumable_item_id, consumable_list_id, consumable_list_cd, consumable_item_qty, consumable_item_unit_amt, consumable_item_total_concession_amt, consumable_item_final_amt, comments, added_to_bill_ts, added_to_bill_by, created_by, created_ts, modified_ts, modified_by, active_flg, source_cd, etl_load_id ",
			"insert_query": "SELECT ds.hospital_key, fpv.patient_visit_key, fpv.patient_key, dp.product_key, ds.store_key, dpb.product_batch_key, dsf.staff_key as consumable_added_staff_key, pvci.visit_consumable_item_id AS consumable_item_id, pvcl.visit_consumable_list_id AS consumable_list_id, pvcl.visit_consumable_list_cd AS consumable_list_cd, pvci.consumable_item_qty, pvci.consumable_item_unit_amt, pvci.consumable_item_total_concession_amt, pvci.consumable_item_final_amt, pvci.comments, pvcl.added_to_bill_ts, pvcl.added_to_bill_by, pvci.created_by, pvci.created_ts, pvci.modified_ts, pvci.modified_by, pvci.active_flg,'{0}',{1} FROM healthscore_stg.hs_patient_visit_consumable_items pvci JOIN healthscore_stg.hs_patient_visit_consumable_list pvcl ON pvcl.visit_consumable_list_id = pvci.visit_consumable_list_id JOIN healthscore_dw.dim_store ds ON ds.store_id = pvci.hospital_store_master_id AND ds.source_cd = '{0}' JOIN healthscore_dw.dim_staff dsf ON dsf.hospital_staff_user_nm = pvci.created_by AND dsf.hospital_key = ds.hospital_key JOIN healthscore_dw.fact_patient_visits fpv ON fpv.hospital_patient_visit_id = pvcl.patient_visit_id AND fpv.source_cd = '{0}' JOIN healthscore_dw.dim_product dp ON dp.hospital_key = ds.hospital_key AND dp.product_id = pvci.product_master_id JOIN healthscore_dw.dim_product_batch dpb ON dpb.product_key = dp.product_key AND dpb.stock_batch_no = pvci.stock_batch_no ",
			"where_clause": "ds.hospital_key=%i",
			"update_fields": "patient_visit_key = src.patient_visit_key, product_key = src.product_key, store_key =src.store_key, product_batch_key = src.product_batch_key, consumable_added_staff_key = src.consumable_added_staff_key, consumable_list_id= src.consumable_list_id, consumable_list_cd =src.consumable_list_cd, consumable_item_qty = src.consumable_item_qty, consumable_item_unit_amt =src.consumable_item_unit_amt, consumable_item_total_concession_amt = src.consumable_item_total_concession_amt, consumable_item_final_amt = src.consumable_item_final_amt, comments =src.comments, added_to_bill_ts =src.added_to_bill_ts, added_to_bill_by =src.added_to_bill_by, created_by = src.created_by, created_ts =src.created_ts, modified_ts = src.modified_ts, modified_by = src.modified_by, active_flg=src.active_flg"
		},
		{
			"tablename": "fact_pharmacy_bills",
			"source_table": "hs_patient_visit_pharmacy_bill_master",
			"fields": "hospital_key, pharmacy_bill_date_key, patient_visit_key, patient_visitbill_key, patient_key, store_key, reference_doctor_staff_key, pharmacy_bill_id, pharmacy_bill_cd, pharmacy_bill_from_ts, pharmacy_bill_to_ts, pharmacy_bill_total_amt, pharmacy_bill_total_concession_amt, pharmacy_bill_amt_paid, pharmacy_bill_refund_amt, active_flg, bill_created_ts, bill_created_staff_key, bill_modified_staff_key, bill_modified_ts, source_cd , etl_load_id ",
			"insert_query": "SELECT dh.hospital_key, date(pharmacy_bill_to_ts) as pharmacy_bill_date_key, pvb.patient_visit_key, pvb.patient_visitbill_key, pvb.patient_key, ds.store_key, dim_s.staff_key as reference_doctor_staff_key, pbm.visit_pharmacy_bill_id as pharmacy_bill_id, pbm.visit_pharmacy_bill_cd as pharmacy_bill_cd, pharmacy_bill_from_ts, pharmacy_bill_to_ts, pharmacy_bill_total_amt, pharmacy_bill_total_concession_amt, pharmacy_bill_amt_paid, pharmacy_bill_refund_amt, pbm.active_flg, pbm.created_ts bill_created_ts, dim_created_by.staff_key as bill_created_staff_key, dim_modified_by.staff_key as bill_modified_staff_key, pbm.modified_ts as bill_modified_ts, '{0}',{1} FROM healthscore_stg.hs_patient_visit_pharmacy_bill_master pbm JOIN healthscore_stg.hs_hospital_master hm ON hm.hospital_id = pbm.hospital_id JOIN healthscore_dw.dim_hospital dh ON dh.hospital_cd = hm.hs_hospital_cd_guid LEFT JOIN healthscore_dw.fact_patient_visitbills pvb ON pvb.visit_bill_id = pbm.visit_bill_id and pvb.visit_hospital_key = dh.hospital_key JOIN healthscore_dw.dim_store ds ON ds.store_id = pbm.hospital_store_master_id and ds.hospital_key = dh.hospital_key LEFT JOIN healthscore_dw.dim_staff dim_s ON dim_s.hospital_staff_id = pbm.ref_dr_hospital_staff_id AND dim_s.hospital_key = dh.hospital_key LEFT JOIN healthscore_dw.dim_staff dim_created_by ON dim_created_by.hospital_staff_user_nm = pbm.created_by AND dim_created_by.hospital_key = dh.hospital_key LEFT JOIN healthscore_dw.dim_staff dim_modified_by ON dim_modified_by.hospital_staff_user_nm = pbm.modified_by AND dim_modified_by.hospital_key = dh.hospital_key",
			"where_clause": "dh.hospital_key=%i",
			"update_fields": " pharmacy_bill_date_key = src.pharmacy_bill_date_key, patient_visit_key = src.patient_visit_key, patient_visitbill_key = src.patient_visitbill_key, patient_key = src.patient_key, store_key = src.store_key, reference_doctor_staff_key = src.reference_doctor_staff_key, pharmacy_bill_cd = src.pharmacy_bill_cd, pharmacy_bill_from_ts = src.pharmacy_bill_from_ts, pharmacy_bill_to_ts=src.pharmacy_bill_to_ts, pharmacy_bill_total_amt=src.pharmacy_bill_total_amt, pharmacy_bill_total_concession_amt=src.pharmacy_bill_total_concession_amt, pharmacy_bill_amt_paid=src.pharmacy_bill_amt_paid, pharmacy_bill_refund_amt=src.pharmacy_bill_refund_amt, active_flg=src.active_flg, bill_created_ts=src.bill_created_ts, bill_created_staff_key=src.bill_created_staff_key, bill_modified_staff_key=src.bill_modified_staff_key, bill_modified_ts=src.bill_modified_ts"
		},
		{
			"tablename": "fact_pharmacy_bill_items",
			"source_table": "hs_patient_visit_pharmacy_items",
			"fields": "pharmacy_bill_key, hospital_key, product_key, product_batch_key, pharmacy_bill_item_id, pharmacy_bill_item_qty, pharmacy_bill_item_unit_amt, pharmacy_bill_item_total_concession_amt, pharmacy_bill_item_final_amt, pharmacy_bill_item_total_tax_amt, pharmacy_bill_item_type, tax_type_nm, tax_value_in_per, pharmacy_bill_item_comments, active_flg, bill_item_created_ts, bill_item_created_staff_key, bill_item_modified_staff_key, bill_item_modified_ts, source_cd , etl_load_id ",
			"insert_query": " SELECT  fpb.pharmacy_bill_key, hpvpi.visit_pharmacy_item_id AS pharmacy_bill_item_id, dp.hospital_key, dp.product_key, pb.product_batch_key, hpvpi.pharmacy_item_qty AS pharmacy_bill_item_qty, hpvpi.pharmacy_item_unit_amt AS pharmacy_bill_item_unit_amt, hpvpi.pharmacy_item_total_concession_amt AS pharmacy_bill_item_total_concession_amt, hpvpi.pharmacy_item_final_amt AS pharmacy_bill_item_final_amt, hpvpi.item_total_tax_amt AS pharmacy_bill_item_total_tax_amt, hpvpi.item_type AS pharmacy_bill_item_type, ttm.tax_type_nm, ttm.tax_value_in_per, hpvpi.comments AS pharmacy_bill_item_comments, hpvpi.active_flg, hpvpi.created_ts AS bill_item_created_ts, dim_created_by.staff_key AS bill_item_created_staff_key, dim_modified_by.staff_key AS bill_item_modified_staff_key, hpvpi.modified_ts AS bill_item_modified_ts,'{0}',{1} FROM healthscore_stg.hs_patient_visit_pharmacy_items hpvpi JOIN healthscore_dw.fact_pharmacy_bills fpb ON fpb.pharmacy_bill_id = hpvpi.visit_pharmacy_bill_id AND fpb.source_cd = '{0}' JOIN healthscore_dw.dim_product dp ON dp.hospital_key = fpb.hospital_key AND dp.product_id = hpvpi.product_master_id JOIN healthscore_dw.dim_product_batch pb ON pb.product_key = dp.product_key     AND pb.stock_batch_no = hpvpi.stock_batch_no JOIN healthscore_stg.hs_tax_type_master ttm ON ttm.tax_type_id = hpvpi.tax_type_id LEFT JOIN healthscore_dw.dim_staff dim_created_by ON dim_created_by.hospital_staff_user_nm = hpvpi.created_by AND dim_created_by.hospital_key = dp.hospital_key LEFT JOIN healthscore_dw.dim_staff dim_modified_by ON dim_modified_by.hospital_staff_user_nm = hpvpi.modified_by AND dim_modified_by.hospital_key = dp.hospital_key",
			"where_clause": "dp.hospital_key=%i",
			"update_fields": " pharmacy_bill_key = src.pharmacy_bill_key,  product_key=src.product_key, product_batch_key=src.product_batch_key, pharmacy_bill_item_qty=src.pharmacy_bill_item_qty, pharmacy_bill_item_unit_amt=src.pharmacy_bill_item_unit_amt, pharmacy_bill_item_total_concession_amt=src.pharmacy_bill_item_total_concession_amt, pharmacy_bill_item_final_amt=src.pharmacy_bill_item_final_amt, pharmacy_bill_item_total_tax_amt=src.pharmacy_bill_item_total_tax_amt, pharmacy_bill_item_type=src.pharmacy_bill_item_type, tax_type_nm=src.tax_type_nm, tax_value_in_per=src.tax_value_in_per, pharmacy_bill_item_comments=src.pharmacy_bill_item_comments, active_flg=src.active_flg, bill_item_created_ts=src.bill_item_created_ts, bill_item_created_staff_key=src.bill_item_created_staff_key, bill_item_modified_staff_key=src.bill_item_modified_staff_key, bill_item_modified_ts=src.bill_item_modified_ts "
		},
		{
			"tablename": "fact_pharmacy_bill_payments",
			"source_table": "hs_patient_visit_pharmacy_items",
			"fields": "pharmacy_bill_key, hospital_key,  pharmacy_bill_item_id, pharmacy_bill_item_final_amt,  pharmacy_bill_item_type, payment_method_desc, card_last_4_digits, card_approval_code, payment_comments, payment_receipt_no, active_flg, bill_item_created_ts, bill_item_created_staff_key, bill_item_modified_staff_key, bill_item_modified_ts, source_cd , etl_load_id ",
			"insert_query": " SELECT  fpb.pharmacy_bill_key, fpb.hospital_key, hpvpi.visit_pharmacy_item_id AS pharmacy_bill_item_id,    hpvpi.pharmacy_item_final_amt AS pharmacy_bill_item_final_amt, hpvpi.item_type as pharmacy_bill_item_type, hpmm.payment_method_desc, hpvpi.card_last_code AS card_last_4_digits, hpvpi.card_approval_code, hpvpi.payment_comments, hpvpi.payment_receipt_no, hpvpi.active_flg, hpvpi.created_ts AS bill_item_created_ts, dim_created_by.staff_key AS bill_item_created_staff_key, dim_modified_by.staff_key AS bill_item_modified_staff_key, hpvpi.modified_ts AS bill_item_modified_ts,'{0}',{1} FROM healthscore_stg.hs_patient_visit_pharmacy_items hpvpi JOIN healthscore_dw.fact_pharmacy_bills fpb ON fpb.pharmacy_bill_id = hpvpi.visit_pharmacy_bill_id AND fpb.source_cd = '{0}' JOIN healthscore_stg.hs_hospital_payment_methods_master hpmm ON hpmm.payment_method_id = hpvpi.payment_method_id LEFT JOIN healthscore_dw.dim_staff dim_created_by ON dim_created_by.hospital_staff_user_nm = hpvpi.created_by AND dim_created_by.hospital_key = fpb.hospital_key LEFT JOIN healthscore_dw.dim_staff dim_modified_by ON dim_modified_by.hospital_staff_user_nm = hpvpi.modified_by AND dim_modified_by.hospital_key = fpb.hospital_key ",
			"where_clause": "fpb.hospital_key=%i and hpvpi.item_type  in ('PYR','PRF')",
			"update_fields": " pharmacy_bill_key = src.pharmacy_bill_key, pharmacy_bill_item_final_amt=src.pharmacy_bill_item_final_amt, pharmacy_bill_item_type=src.pharmacy_bill_item_type, payment_method_desc=src.payment_method_desc, card_last_4_digits=src.card_last_4_digits, card_approval_code=src.card_approval_code, payment_comments=src.payment_comments, payment_receipt_no=src.payment_receipt_no, active_flg=src.active_flg, bill_item_created_ts=src.bill_item_created_ts, bill_item_created_staff_key=src.bill_item_created_staff_key, bill_item_modified_staff_key=src.bill_item_modified_staff_key, bill_item_modified_ts=src.bill_item_modified_ts "
		}
	],
	"update_table_info": []
}
